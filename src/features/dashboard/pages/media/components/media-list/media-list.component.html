<form [formGroup]="mediaForm" class="mat-elevation-z8">
  <ng-container *rxLet="mediaItems$; let items; suspense: suspense; suspenseTrigger: suspenseTrigger$">
    <table mat-table formArrayName="media" [dataSource]="dataSource" [trackBy]="trackMedia">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let item">{{ item.id }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Name</th>
        <td mat-cell *matCellDef="let item; let rowIndex = index" [formGroupName]="rowIndex">
          <div>
            <ng-container *rxIf="editingIdx === item.id || item.id === 'null'; else name">
              <mat-form-field appearance="outline">
                <input matNativeControl type="text" size="2" formControlName="name" />
              </mat-form-field>
            </ng-container>
            <ng-template #name>
              {{ item.name }}
            </ng-template>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let item; let rowIndex = index" [formGroupName]="rowIndex">
          <div>
            <ng-container *rxIf="editingIdx === item.id || item.id === 'null'; else status">
              <mat-form-field appearance="outline">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status">
                  <mat-option *ngFor="let status of mediaStatuses" [value]="status">
                    {{ status }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </ng-container>
            <ng-template #status>
              {{ item.status }}
            </ng-template>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="createdBy">
        <th mat-header-cell *matHeaderCellDef>CreatedBy</th>
        <td mat-cell *matCellDef="let item">{{ item.createdBy }}</td>
      </ng-container>

      <ng-container matColumnDef="lastUpdated">
        <th mat-header-cell *matHeaderCellDef>Last Updated</th>
        <td mat-cell *matCellDef="let item">{{ item.lastUpdated | date }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let item; let rowIndex = index">
          <div>
            <button
              mat-stroked-button
              type="button"
              (click)="onRowEdit(item.id, editingIdx === item.id || item.id === 'null')">
              {{ editingIdx === item.id || item.id === 'null' ? 'Save' : 'Edit' }}
            </button>

            <button
              mat-stroked-button
              type="button"
              (click)="onRowCancel(item.id)"
              *rxIf="editingIdx === item.id || item.id === 'null'">
              Cancel
            </button>

            <button
              mat-stroked-button
              *rxIf="!(editingIdx === item.id || item.id === 'null')"
              type="button"
              (click)="onRowRemove(item.id)">
              Remove
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </ng-container>
</form>

<mat-paginator
  class="mat-elevation-z8"
  #paginator
  [length]="total$ | push"
  [pageSizeOptions]="pageSizes"
  [pageSize]="25"
  showFirstLastButtons></mat-paginator>

<ng-template #suspense>
  <div class="spinner-wrapper">
    <mat-spinner [diameter]="64"></mat-spinner>
  </div>
</ng-template>
